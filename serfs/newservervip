#!/bin/bash
#inkVerbSerf! verb.ink

# This creates a user who can read everything on the server and has a www/vip symlink in the home folder

# How to use:
## ./newservervip [ new user ] [ new user password ]


usagenotes="This creates a user who can read everything on the server and has a www/vip symlink in the home folder"
usageformat="newservervip [ new user ] [ new user password ]"
usageexample="newservervip userjohn NotSecure125"
hierarchy=( primary )
vsetnames=( "Username" "Password" )
vsettypes=( isUsername string_quote )
voptnames=(  )
vopttypes=(  )
voptflags=(  )
voptflagpurpose=(  )
dependencyinstall=(  )
prerequesite=(  )
usedby=(  )
useserfs=(  )
useconfigs=(  )
if [ -n "$infoINKonly" ] && [ "$infoINKonly" = "true" ]; then return 0; fi # Must have for proper usage to not run the full serf
if [ -e "/opt/verb/mods/newservervip.replace" ]; then . /opt/verb/mods/newservervip.replace; return 0; fi # Precedes this script
if [ -e "/opt/verb/mods/newservervip.before" ]; then . /opt/verb/mods/newservervip.before; return 0; fi # Replaces this script


NEWFILEUSER=$1
NEWUSERPASS=$2

# Create the user with password
/usr/bin/groupadd ${NEWFILEUSER}
/usr/bin/useradd -g ${NEWFILEUSER} ${NEWFILEUSER}
/bin/echo "${NEWFILEUSER}:${NEWUSERPASS}" | chpasswd
/usr/bin/usermod -a -G sudo ${NEWFILEUSER}
/usr/bin/usermod -a -G www ${NEWFILEUSER}
/usr/bin/mkdir -p /home/${NEWFILEUSER}
/bin/ln -sfn /opt/verb/boss /home/${NEWFILEUSER}/
## User privilege specification
/usr/bin/setfacl -R -m user:${NEWFILEUSER}:rwx /home/${NEWFILEUSER}  # DEV see if this line works

## This was created with the following base script
# sudo /usr/sbin/adduser myuser --gecos "First Last,RoomNumber,WorkPhone,HomePhone" --disabled-password
# /bin/echo "myuser:password" | sudo chpasswd

# Create the www symlink
/bin/ln -s /srv/www/vip /home/${NEWFILEUSER}/vip





if [ -e "/opt/verb/mods/newservervip.after" ]; then . /opt/verb/mods/newservervip.after; fi # Follows this script
